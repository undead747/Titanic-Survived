labs( x  = "Ticket first char " ,
y = "Total count" ,
title = "Survived"
)
ggplot(data.combined[1:891,], aes(x = Fare, fill = Survived)) +
geom_histogram(binwidth = 5) +
theme_bw() +
ylim(0,40) +
facet_wrap(Pclass ~ title) +
labs( x  = "Ticket first char " ,
y = "Total count" ,
title = "Survived"
)
str(data.combined$Cabin)
data.combined$Cabin <- as.character(data.combined$Cabin)
data.combined$Cabin[1:100]
data.combined[which(data.combined$Cabin == ""),"Cabin"] <- "U"
data.combined$Cabin[1:100]
Cabin.first.char <- as.factor(substr(data.combined$Cabin,1,1))
str(Cabin.first.char)
levels(Cabin.first.char)
data.combined$Cabin.first.char <- Cabin.first.char
ggplot(data.combined[1:891,], aes(x = Cabin.first.char, fill = Survived)) +
geom_bar() +
theme_bw() +
ylim(0,750)
ggplot(data.combined[1:891,], aes(x = Cabin.first.char, fill = Survived)) +
geom_bar() +
theme_bw() +
ylim(0,750) +
facet_wrap(~ Pclass)
ggplot(data.combined[1:891,], aes(x = Cabin.first.char, fill = Survived)) +
geom_bar() +
theme_bw() +
ylim(0,500) +
facet_wrap(title ~ Pclass)
data.combined$cabin.multiple <- as.factor(ifelse(str_detect(data.combined$Cabin," "),"Y","N"))
ggplot(data.combined[1:891,], aes(x = cabin.multiple, fill = Survived)) +
geom_bar() +
theme_bw() +
ylim(0,350) +
facet_wrap(~ Pclass + title)
str(data.combined$Embarked)
levels(data.combined$Embarked)
ggplot(data.combined[1:891,], aes(x = Embarked, fill = Survived)) +
geom_bar() +
theme_bw() +
ylim(0,350) +
facet_wrap(~ Pclass + title)
#-------------------------------------------- Training model thing ----------------
#--------------------------------------------- Random forest thing ----------------
#Train a Random Forest with the default param using Pclass & title
library(randomForest)
rf.train.1 <- data.combined[1:891, c("Pclass","title")]
View(rf.train.1)
rf.label <- as.factor(train$Survived)
# when number in random generated it will still keep the value of the created random
set.seed(1234)
rf.1 <- randomForest(x = rf.train.1, y = rf.label, importance = TRUE, ntree = 1000)
#--------------------------------------------- End of Random forest thing ----------------
#-------------------------------------------- End of Training model thing ----------------
rf.1
varImpPlot(rf.1)
varImpPlot(rf.1)
varImpPlot(rf.1)
rf.1
varImpPlot(rf.1)
par("mar")
par(mar=c(1,1,1,1))
varImpPlot(rf.1)
varImpPlot(rf.1)
rf.train.2 <- data.combined[1:891,"Pclass","title"]
rf.train.2 <- data.combined[1:891,c("Pclass","title","Sibsp")]
rf.train.2 <- data.combined[1:891,c("Pclass","title","SibSp")]
rf.2 <- randomForest(x = rf.train.2, y = rf.label, importance =  TRUE, ntree = 1000)
rf.2
ggplot(data.combined[1:891,], aes(x = cabin.multiple, fill = Survived)) +
geom_bar() +
theme_bw() +
ylim(0,350) +
facet_wrap(~ Pclass + title)
str(data.combined$Embarked)
levels(data.combined$Embarked)
ggplot(data.combined[1:891,], aes(x = cabin.multiple, fill = Survived)) +
geom_bar() +
theme_bw() +
ylim(0,350) +
facet_wrap(~ Pclass + title)
ggplot(data.combined, aes(x = Fare)) +
geom_histogram(binwidth = 5) +
theme_bw() +
labs( x  = "Ticket first char " ,
y = "Total count" ,
title = "Survived"
)
# set directory
setwd("/home/minhdeptrai/Downloads/R workspace/titanic")
#Load raw data
train <- read.csv("train.csv", header = TRUE)
test <- read.csv("test.csv", header = TRUE)
#survived <- subset.data.frame(train , Survived == 1)
#notSurvived <- subset.data.frame(train, Survived == 0)
#------------------------------------------ data table examinate -----------------------------------------
#Add a "Survived" to the test set to allow for combining data sets
#Make a new variable and call it "test.survived", after that create a new data.frame with have a combine of
# bunch of column name survived with have "None" varible and all the variable of test.csv
test.survived <- data.frame(Survived = rep("None",nrow(test)),test[,])
test.survived <- test.survived[,c(2,1,3,4,5,6,7,8,9,10,11,12)]
#Combine data sets
data.combined <- rbind(train, test.survived)
#------------------------------------------ end data table examinate -----------------------------------------
#A bit about R data types
str(data.combined)
#Factors are the data objects which are used to categorize the data and store it as levels.
#They can store both strings and integers. They are useful in the columns which have a
#limited number of unique values. Like "Male, "Female" and True, False etc. They are useful
#in data analysis for statistical modeling.
# On creating any data frame with a column of text data,
# R treats the text column as categorical data and creates factors on it.
data.combined$Survived <- as.factor(data.combined$Survived)
data.combined$Pclass <- as.factor(data.combined$Pclass)
#Take a look at gross survival rates
table(data.combined$Survived)
table(data.combined$Pclass)
#Load up gglot2 package to use for viusualization
library(ggplot2)
#convert data into factor
train$Pclass <- factor(train$Pclass)
train$Sex <- factor(train$Sex)
train$Embarked <- factor(train$Embarked)
train$Survived <- factor(train$Survived)
#---------------------------------------------------- ggplot 2 ------------------------------------------
ggplot(train, aes(x = Survived)) + geom_bar()
prop.table(table(train$Survived))
ggplot(train, aes(x = Survived)) +
theme_bw() +
geom_bar() +
labs( y = "Passeger count",
title = "titanic Survival Rates"
)
ggplot(train, aes(x = Sex)) +
theme_bw() +
geom_bar() +
labs( y = "Passeger count",
title = "titanic Survival Rates"
)
ggplot(train, aes(x = Age)) +
theme_light() +
geom_bar() +
labs( y = "Passeger count",
title = "titanic Survival Rates"
)
ggplot(survived, aes(x = Sex)) +
theme_bw() +
geom_bar() +
labs( y = "Passeger count",
title = "titanic Survived Passeger Rates By Sex"
)
ggplot(notSurvived, aes(x = Sex)) +
theme_bw() +
geom_bar() +
labs( y = "Passeger count",
title = "titanic Did Not Survived Passeger Rates By Sex"
)
ggplot(train, aes(x = Sex,fill = Survived)) +
theme_bw() +
geom_bar() +
labs( y = "Passeger count",
title = "titanic Survival Rates"
)
ggplot(train, aes(x = Pclass,fill = Survived)) +
theme_bw() +
geom_bar() +
labs( y = "Passeger count",
title = "titanic Survival Rates"
)
ggplot(train, aes(x = Sex, fill = Survived)) +
theme_bw() +
geom_bar() +
facet_wrap( ~ Pclass) +
labs( y = "Passeger Count",
title = "Titanic Survival Rates By  Pclass and Sex"
)
ggplot(train, aes(x = Sex)) +
theme_bw() +
geom_bar() +
facet_wrap( ~ Survived) +
labs( y = "Passeger Count",
title = "Titanic Survival Rates By Sex"
)
ggplot(train, aes(x = Age)) +
theme_bw() +
geom_histogram(binwidth =  5) +
labs(y = "Passeger Count",
x = "Age With Binwidth = 5",
title = "Titanic Age Distribtion"
)
ggplot(train, aes(x = Age, fill = Survived)) +
theme_bw() +
geom_histogram(binwidth =  5) +
labs(y = "Passeger Count",
x = "Age With Binwidth = 5",
title = "Titanic Age Distribtion"
)
ggplot(train, aes(x = Age, fill = Survived)) +
theme_bw() +
facet_wrap(Sex ~ Pclass) +
geom_density(alpha = 0.5) +
labs(y = "Age",
x = "Survived",
title = "Titanic survival Rates by Age, Pclass and Sex"
)
ggplot(train, aes(x = Age, fill = Survived)) +
theme_bw() +
facet_wrap(Sex ~ Pclass) +
geom_histogram(binwidth = 5) +
labs(y = "Age",
x = "Survived",
title = "Titanic survival Rates by Age, Pclass and Sex"
)
#Hypothesis - Rich folks survived at higher rate
ggplot(train,aes(x = Pclass, fill = Survived)) +
theme_bw() +
geom_bar() +
labs(x = "Class",
y = "Total Passager",
title = "Titanic Rate By Class and Survival"
)
#---------------------------------------------------- end of ggplot 2 ------------------------------------------
#--------------------------------------------------- Get the ms mrs mr from data.combined ---------------------
#examine the first few names in the training data set
head(as.character(train$Name))
#How many unique name are there across both train and test
length(unique(as.character(data.combined$Name)))
#Get the duplicate names and store them as a vector
dup.names <- as.character(data.combined[which(duplicated(as.character(data.combined$Name))), "Name"])
table(dup.names)
#Take a look at the records in data set
data.combined[which(data.combined$Name %in% dup.names),]
library(stringr)
#Any correlation with other varibable(e.g, sibsp) ?
misses <- data.combined[which(str_detect(data.combined$Name, "Miss.")), ]
misses[1:5,]
mres <- data.combined[which(str_detect(data.combined$Name, "Mrs.")),]
mres[1:5,]
male <- data.combined[which(train$Sex == "male"),]
male[1:5,]
#--------------------------------------------------- End Get the ms mrs mr from data.combined ---------------------
#Expand upon the relationship between 'Survived' and "Pclass" by adding the new "Title" variable
#---------------------------------------------------- Create the column Title --------------------------------------
#Create the unity fuction to help with title extraction
extractTitle <- function(name) {
name <- as.character(name)
if(length(grep("Miss.", name)) > 0){
return ("Miss.")
}else if(length(grep("Master.", name)) > 0){
return ("Master.")
}else if(length(grep("Mrs.", name)) > 0){
return ("Mrs")
}else if(length(grep("Mr.", name)) > 0){
return ("Mr")
}else {
return ("Other")
}
}
titles <- NULL
for(i in 1:nrow(data.combined)) {
titles <- c(titles, extractTitle(data.combined[i,"Name"]))
}
data.combined$title <- factor(titles)
#---------------------------------------------------- End of Create the column Title --------------------------------------
ggplot(data.combined[1:891,], aes(x = title,fill = Survived)) +
theme_bw() +
geom_bar() +
facet_wrap( ~ Pclass) +
labs( x = "Title",
y = "Total Passager",
title = "Title"
)
#What's the distribution of felmales to males across train & test ?
table(data.combined$Sex)
ggplot(data.combined[1:891,], aes(x = Sex, fill = Survived)) +
theme_bw() +
geom_bar() +
facet_wrap(~ Pclass) +
labs(x = "Sex",
y = "Total Count",
title = "Rate Survival by Sex and Pclass"
)
#Look at the distibution of age over entire date set
summary(data.combined$Age)
summary(data.combined[1:891,]$Age)
#Validate that "Master." is a good proxy for male children
boys <- data.combined[which(data.combined$title == "Master."),]
summary(boys$Age)
summary(male$Age)
summary(misses$Age)
ggplot(misses[misses$Survived != "None",],aes(x = Age,fill = Survived)) +
facet_wrap(~Pclass) +
geom_histogram(binwidth = 5) +
labs( x = "Age",
y = "Total Count",
title = "Age for Miss by Pclass"
)
misses.alone <- misses[which(misses$SibSp == 0 & misses$Parch == 0),]
summary(misses.alone$Age)
length(which(misses.alone$Age <= 14.5))
summary(data.combined$SibSp)
length(unique(data.combined$SibSp))
print(unique(data.combined$SibSp))
data.combined$SibSp <- factor(data.combined$SibSp)
ggplot(data.combined[1:891,],aes(x = SibSp,fill = Survived)) +
theme_bw() +
geom_bar() +
facet_wrap(title ~ Pclass) +
labs(x = "Sib",
y = "Total Count",
title = "Rate Sib by title and Pclass"
)
data.combined$Parch <- as.factor(data.combined$Parch)
ggplot(data.combined[1:891,],aes(x = Parch,fill = Survived)) +
theme_bw() +
geom_bar() +
facet_wrap(title ~ Pclass) +
labs(x = "Sib",
y = "Total Count",
title = "Rate Patch by title and Pclass"
)
temp.sibsp <- c(train$SibSp,test$SibSp)
temp.parch <- c(train$Parch,test$Parch)
data.combined$family.size <- as.factor(temp.sibsp + temp.parch + 1)
ggplot(data.combined[1:891,],aes(x = family.size, fill = Survived)) +
geom_bar() +
facet_wrap(Pclass ~ title) +
labs(x = "family Size",
y = "Total Count",
title = "Rate family size by title and Pclass"
)
str(data.combined$Ticket)
data.combined$Ticket <- as.character(data.combined$Ticket)
data.combined$Ticket[1:20]
Ticket.first.char <- ifelse(data.combined$Ticket == "", " ",substr(data.combined$Ticket,1 ,1))
unique(Ticket.first.char)
data.combined$Ticket.first.char <- as.factor(Ticket.first.char)
ggplot(data.combined[1:891,], aes(x = Ticket.first.char, fill = Survived)) +
geom_bar() +
theme_bw() +
labs( x  = "Ticket first char " ,
y = "Total count" ,
title = "Survived"
)
summary(data.combined[1:891,"Ticket.first.char"])
ggplot(data.combined[1:891,], aes(x = Ticket.first.char, fill = Survived)) +
geom_bar() +
facet_wrap(~ Pclass) +
theme_bw() +
labs( x  = "Ticket first char " ,
y = "Total count" ,
title = "Survived"
)
ggplot(data.combined[1:891,], aes(x = Ticket.first.char, fill = Survived)) +
geom_bar() +
facet_wrap(~ Pclass + title) +
theme_bw() +
labs( x  = "Ticket first char " ,
y = "Total count" ,
ylim(0,200),
title = "Survived"
)
summary(data.combined$Fare)
length(unique(data.combined$Fare))
str(data.combined$Fare)
ggplot(data.combined, aes(x = Fare)) +
geom_bar() +
theme_bw() +
labs( x  = "Ticket first char " ,
y = "Total count" ,
title = "Survived"
)
ggplot(data.combined, aes(x = Fare)) +
geom_histogram(binwidth = 5) +
theme_bw() +
labs( x  = "Ticket first char " ,
y = "Total count" ,
title = "Survived"
)
ggplot(data.combined[1:891,], aes(x = Fare, fill = Survived)) +
geom_histogram(binwidth = 5) +
theme_bw() +
ylim(0,40) +
facet_wrap(Pclass ~ title) +
labs( x  = "Ticket first char " ,
y = "Total count" ,
title = "Survived"
)
str(data.combined$Cabin)
data.combined$Cabin <- as.character(data.combined$Cabin)
data.combined$Cabin[1:100]
data.combined[which(data.combined$Cabin == ""),"Cabin"] <- "U"
data.combined$Cabin[1:100]
Cabin.first.char <- as.factor(substr(data.combined$Cabin,1,1))
str(Cabin.first.char)
levels(Cabin.first.char)
data.combined$Cabin.first.char <- Cabin.first.char
ggplot(data.combined[1:891,], aes(x = Cabin.first.char, fill = Survived)) +
geom_bar() +
theme_bw() +
ylim(0,750)
ggplot(data.combined[1:891,], aes(x = Cabin.first.char, fill = Survived)) +
geom_bar() +
theme_bw() +
ylim(0,750) +
facet_wrap(~ Pclass)
ggplot(data.combined[1:891,], aes(x = Cabin.first.char, fill = Survived)) +
geom_bar() +
theme_bw() +
ylim(0,500) +
facet_wrap(title ~ Pclass)
data.combined$cabin.multiple <- as.factor(ifelse(str_detect(data.combined$Cabin," "),"Y","N"))
ggplot(data.combined[1:891,], aes(x = cabin.multiple, fill = Survived)) +
geom_bar() +
theme_bw() +
ylim(0,350) +
facet_wrap(~ Pclass + title)
str(data.combined$Embarked)
levels(data.combined$Embarked)
ggplot(data.combined[1:891,], aes(x = Embarked, fill = Survived)) +
geom_bar() +
theme_bw() +
ylim(0,350) +
facet_wrap(~ Pclass + title)
#-------------------------------------------- Training model thing ----------------
#--------------------------------------------- Random forest thing ----------------
#Train a Random Forest with the default param using Pclass & title
library(randomForest)
rf.train.1 <- data.combined[1:891, c("Pclass","title")]
View(rf.train.1)
rf.label <- as.factor(train$Survived)
# when number in random generated it will still keep the value of the created random
set.seed(1234)
#OOB stand for out of bag witch mean a number of data that are not include in built data for training tree
#OOB data can be used for testing the acurate of algorithm
rf.1 <- randomForest(x = rf.train.1, y = rf.label, importance = TRUE, ntree = 1000)
rf.1
varImpPlot(rf.1)
rf.train.2 <- data.combined[1:891,c("Pclass","title","SibSp")]
set.seed(1234)
rf.2 <- randomForest(x = rf.train.2, y = rf.label, importance =  TRUE, ntree = 1000)
rf.2
#--------------------------------------------- End of Random forest thing ----------------
#-------------------------------------------- End of Training model thing ----------------
ggplot(data.combined[1:891,], aes(x = Embarked, fill = Survived)) +
geom_bar() +
theme_bw() +
ylim(0,350) +
facet_wrap(~ Pclass + title)
ggplot(data.combined[1:891,], aes(x = cabin.multiple, fill = Survived)) +
geom_bar() +
theme_bw() +
ylim(0,350) +
facet_wrap(~ Pclass + title)
ggplot(data.combined[1:891,], aes(x = Fare, fill = Survived)) +
geom_histogram(binwidth = 5) +
theme_bw() +
ylim(0,40) +
facet_wrap(Pclass ~ title) +
labs( x  = "Ticket first char " ,
y = "Total count" ,
title = "Survived"
)
view(data.combined)
View(data.combined)
rf.2
rf.train.3 <- data.combined[1:891,c("Pclass","title","Parch")]
set.seed(1234)
rf.train.3 <- data.combined[1:891,c("Pclass","title","Parch")]
set.seed(1234)
rf.3 <- randomForest(x = rf.train.3, y = rf.label, importance = TRUE, ntree = 1000)
rf.3
varImpPlot(rf.2)
rf.train.4 <- data.combined[1:891,c("Pclass","title","Parch","SibSp")]
set.seed(1234)
rf.4 <- randomForest(x = rf.train.4, y = rf.label,importance = TRUE,ntree = 1000)
rf.4
rf.train.5 <- data.combined[1:891,c("Pclass","title","family.size")]
rf.train.5 <- data.combined[1:891,c("Pclass","title","family.size")]
set.seed(1234)
rf.5 <- randomForest(x = rf.train.5, y = rf.label, importance = TRUE, ntree = 1000)
rf.5
varImpPlot(rf.5)
#----------------------------- model ver 6 ----------------------------------------
rf.train.6 <- data.combined[1:891,c("Pclass","title","SibSp","family.size")]
set.seed(1234)
rf.6 <- randomForest(x = rf.train.6, y = rf.label, importance = TRUE, ntree = 1000)
rf.6
varImpPlot(rf.6)
#----------------------------- model ver 7 ----------------------------------------
rf.train.7 <- data.combined[1:891,c("Pclass","title","Parch","family.size")]
set.seed(1234)
rf.7 <- randomForest(x = rf.train.7, y = rf.label, importance = TRUE, ntree = 1000)
rf.7
varImpPlot(rf.7)
rf.train.5 <- data.combined[1:891,c("Pclass","title","family.size")]
set.seed(1234)
rf.5 <- randomForest(x = rf.train.5, y = rf.label, importance = TRUE, ntree = 1000)
rf.5
varImpPlot(rf.5)
rf.train.7 <- data.combined[1:891,c("Pclass","title","Parch","family.size")]
set.seed(1234)
rf.7 <- randomForest(x = rf.train.7, y = rf.label, importance = TRUE, ntree = 1000)
rf.7
varImpPlot(rf.7)
